<!--#include file="/parts/head.html" -->
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 id="title" class="h2" data-navbaractive="navdevices">Devices</h1>
</div>
<div class="alert alert-info" role="alert">These are the devices (GPUs and CPUs) detected by NemosMiner. Configuration changes made will become active in the next cycle.</div>

<div id="toolbarenableddevices">
    <button id="disable-device" class="btn btn-danger">Disable Device</button>
</div>

<h3 class="mt-4">Enabled Devices</h3>

<table id="enableddevices" class="table"
    data-icons="icons"
    data-toolbar="#toolbarenableddevices"
    data-url="/devices/enabled"
    data-cache="false"
    data-toggle="table"
    data-filter-control="true"
    data-detail-view="true"
    data-show-button-text="true"
    data-show-columns="true"
    data-show-toggle="true"
    data-show-refresh="true"
    data-detail-view="true"
    data-click-to-select="true"
    data-detail-formatter="detailFormatter"
    data-response-handler="formatDevices"
    >

    <thead>
        <tr>
            <th data-field="state" data-checkbox="true"></th>
            <th data-field="Name" data-sortable="true">Name</th>
            <th data-field="Vendor" data-sortable="true">Vendor</th>
            <th data-field="Model" data-sortable="true">Model</th>
            <th data-field="Status" data-sortable="true">Status</th>
            <th data-field="tMemory" data-sortable="true">Memory</th>
            <th data-field="tCores" data-sortable="true">Cores/Stream Processors</th>
            <th data-field="tClockSpeed" data-sortable="true">Clock Speed</th>
            <th data-field="tDriverVersion">Driver Version</th>
            <th data-field="Bus"data-visible="false" data-sortable="true">PCI Bus Id</th>
            <th data-field="Id" data-visible="false" data-sortable="true">Id</th>
            <th data-field="Type_Id" data-visible="false" data-sortable="true">Type_Id</th>
            <th data-field="Vendor_Id" data-visible="false" data-sortable="true">Vendor_Id</th>
            <th data-field="Type_Vendor_Id" data-visible="false" data-sortable="true">Type_Vendor_Id</th>
            <th data-field="Slot" data-visible="false" data-sortable="true">Slot</th>
            <th data-field="Type_Slot" data-visible="false" data-sortable="true">Type_Slot</th>
            <th data-field="Vendor_Slot" data-visible="false" data-sortable="true">Vendor_Slot</th>
            <th data-field="Type_Vendor_Slot" data-visible="false" data-sortable="true">Type_Vendor_Slot</th>
            <th data-field="Index" data-visible="false" data-sortable="true">Index</th>
            <th data-field="Type_Index" data-visible="false" data-sortable="true">Type_Index</th>
            <th data-field="Vendor_Index" data-visible="false" data-sortable="true">Vendor_Index</th>
            <th data-field="Type_Vendor_Index" data-visible="false" data-sortable="true">Type_Vendor_Index</th>
            <th data-field="PlatformId" data-visible="false" data-sortable="true">PlatformId</th>
            <th data-field="PlatformId_Index" data-visible="false" data-sortable="true">PlatformId_Index</th>
            <th data-field="Type_PlatformId_Index" data-visible="false" data-sortable="true">Type_PlatformId_Index</th>
            <th data-field="tState" data-sortable="true" data-visible="false">State</th>
        </tr>
    </thead>
</table>

<h3 class="mt-4">Disabled Devices</h3>

<div id="toolbardisableddevices">
    <button id="enable-device" class="btn btn-success">Enable Device</button>
</div>

<table id="disableddevices" class="table"
    data-icons="icons"
    data-toolbar="#toolbardisableddevices"
    data-url="/devices/disabled"
    data-cache="false"
    data-toggle="table"
    data-filter-control="true"
    data-detail-view="true"
    data-show-button-text="true"
    data-show-columns="true"
    data-show-toggle="true"
    data-show-refresh="true"
    data-detail-view="true"
    data-click-to-select="true"
    data-detail-formatter="detailFormatter"
    data-response-handler="formatDevices"
    >

    <thead>
        <tr>
            <th data-field="state" data-checkbox="true"></th>
            <th data-field="Name" data-sortable="true">Name</th>
            <th data-field="Vendor" data-sortable="true">Vendor</th>
            <th data-field="Model" data-sortable="true">Model</th>
            <th data-field="Status" data-sortable="true">Status</th>
            <th data-field="tMemory" data-sortable="true">Memory</th>
            <th data-field="tCores" data-sortable="true">Cores/Stream Processors</th>
            <th data-field="tClockSpeed" data-sortable="true">Clock Speed</th>
            <th data-field="tDriverVersion">Driver Version</th>
            <th data-field="Bus"data-visible="false" data-sortable="true">PCI Bus Id</th>
            <th data-field="Id" data-visible="false" data-sortable="true">Id</th>
            <th data-field="Type_Id" data-visible="false" data-sortable="true">Type_Id</th>
            <th data-field="Vendor_Id" data-visible="false" data-sortable="true">Vendor_Id</th>
            <th data-field="Type_Vendor_Id" data-visible="false" data-sortable="true">Type_Vendor_Id</th>
            <th data-field="Slot" data-visible="false" data-sortable="true">Slot</th>
            <th data-field="Type_Slot" data-visible="false" data-sortable="true">Type_Slot</th>
            <th data-field="Vendor_Slot" data-visible="false" data-sortable="true">Vendor_Slot</th>
            <th data-field="Type_Vendor_Slot" data-visible="false" data-sortable="true">Type_Vendor_Slot</th>
            <th data-field="Index" data-visible="false" data-sortable="true">Index</th>
            <th data-field="Type_Index" data-visible="false" data-sortable="true">Type_Index</th>
            <th data-field="Vendor_Index" data-visible="false" data-sortable="true">Vendor_Index</th>
            <th data-field="Type_Vendor_Index" data-visible="false" data-sortable="true">Type_Vendor_Index</th>
            <th data-field="PlatformId" data-visible="false" data-sortable="true">PlatformId</th>
            <th data-field="PlatformId_Index" data-visible="false" data-sortable="true">PlatformId_Index</th>
            <th data-field="Type_PlatformId_Index" data-visible="false" data-sortable="true">Type_PlatformId_Index</th>
            <th data-field="tState" data-sortable="true" data-visible="false">State</th>
        </tr>
    </thead>
</table>

<h3 class="mt-4">Unsupported Devices</h3>

<table id="unsupporteddevices" class="table"
    data-icons="icons"
    data-url="/devices/unsupported"
    data-cache="false"
    data-toggle="table"
    data-detail-view="true"
    data-show-button-text="true"
    data-show-columns="true"
    data-show-toggle="true"
    data-detail-view="true"
    data-click-to-select="true"
    data-detail-formatter="detailFormatter"
    data-response-handler="formatDevices"
    >

    <thead>
        <tr>
            <th data-field="Name" data-sortable="true">Name</th>
            <th data-field="Vendor" data-sortable="true">Vendor</th>
            <th data-field="Model" data-sortable="true">Model</th>
            <th data-field="Status" data-sortable="true">Status</th>
            <th data-field="tMemory" data-sortable="true">Memory</th>
            <th data-field="tCores" data-sortable="true">Cores/Stream Processors</th>
            <th data-field="tClockSpeed" data-sortable="true">Clock Speed</th>
            <th data-field="tDriverVersion">Driver Version</th>
            <th data-field="Bus"data-visible="false" data-sortable="true">PCI Bus Id</th>
            <th data-field="Id" data-visible="false" data-sortable="true">Id</th>
            <th data-field="Type_Id" data-visible="false" data-sortable="true">Type_Id</th>
            <th data-field="Vendor_Id" data-visible="false" data-sortable="true">Vendor_Id</th>
            <th data-field="Type_Vendor_Id" data-visible="false" data-sortable="true">Type_Vendor_Id</th>
            <th data-field="Slot" data-visible="false" data-sortable="true">Slot</th>
            <th data-field="Type_Slot" data-visible="false" data-sortable="true">Type_Slot</th>
            <th data-field="Vendor_Slot" data-visible="false" data-sortable="true">Vendor_Slot</th>
            <th data-field="Type_Vendor_Slot" data-visible="false" data-sortable="true">Type_Vendor_Slot</th>
            <th data-field="Index" data-visible="false" data-sortable="true">Index</th>
            <th data-field="Type_Index" data-visible="false" data-sortable="true">Type_Index</th>
            <th data-field="Vendor_Index" data-visible="false" data-sortable="true">Vendor_Index</th>
            <th data-field="Type_Vendor_Index" data-visible="false" data-sortable="true">Type_Vendor_Index</th>
            <th data-field="PlatformId" data-visible="false" data-sortable="true">PlatformId</th>
            <th data-field="PlatformId_Index" data-visible="false" data-sortable="true">PlatformId_Index</th>
            <th data-field="Type_PlatformId_Index" data-visible="false" data-sortable="true">Type_PlatformId_Index</th>
            <th data-field="tState" data-sortable="true" data-visible="false">State</th>
        </tr>
    </thead>
</table>

<script type='text/javascript'>
    $(function () {
        $('#disable-device').click(function () {
            var $table = $('#enableddevices')
            $Command = 'functions/config/device/disable?ExcludeDeviceName=' + encodeURIComponent($table.bootstrapTable('getSelections').map(item => item.Name))
            $('.modal-body').load($Command, function() {
                $('.modal-title').text($('#disable-device').text());
                $('#myModal').modal({show:true});
            });
        });
    });

    $(function () {
        $('#enable-device').click(function () {
            var $table = $('#disableddevices')
            $Command = 'functions/config/device/enable?DeviceName=' + encodeURIComponent($table.bootstrapTable('getSelections').map(item => item.Name))
            $('.modal-body').load($Command, function() {
                $('.modal-title').text($('#enable-device').text());
                $('#myModal').modal({show:true});
            });
        });
    });

    $('#myModal').on('hidden.bs.modal', function () {
        $('#enableddevices').bootstrapTable('refresh');
        $('#disableddevices').bootstrapTable('refresh');
    });

    function formatDevices(data) {
        // This function can alter the returned data before building the table, formatting it in a way
        // that is easier to display and manipulate in a table
        $.each(data, function(index, item) {
            // Format the device(s)
            if (item.OpenCL) {
                item.tMemory = formatBytes(item.OpenCL.GlobalMemSize)
            } else {
                item.tMemory = 'N/A'
            }

            if (item.OpenCL) {
                item.tClockSpeed = item.OpenCL.MaxClockFrequency
            } else if (item.CIM) {
                item.tClockSpeed = item.CIM.MaxClockSpeed
            } else {
                item.tClockSpeed = 'N/A'
            }

            if (item.OpenCL) {
                item.tDriverVersion = item.OpenCL.DriverVersion
            } else {
                item.tDriverVersion = 'N/A'
            }

            if (item.OpenCL) {
                item.tCores = item.OpenCL.MaxComputeUnits
            } else if (item.CIM) {
                item.tCores = item.CIM.NumberOfLogicalProcessors
            } else {
                item.tCores = 'N/A'
            }

            // Format device state
            const enumstatus = ["Enabled", "Disabled", "Unsupported"];
            item.tState = enumstatus[item.State];
        });
        return data;
    }
</script>
<!-- End of page scripts -->
<!--#include file="/parts/foot.html" -->