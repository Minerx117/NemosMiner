<!--#include file="/parts/head.html" -->
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 id="title" data-navbaractive="navearningschart" class="h2">Earnings Chart</h1>
</div>

<div class="alert alert-info" role="alert">Consolidated earnings of the last 30 active mining days<br>The data is taken from the pools API and may not yet include results from recent mining.</div>

<canvas id="EarningsChart" width="400" height="175" role="img"></canvas>

<!-- Start of page scripts -->

<script type="text/javascript">

  Chart.defaults.global.defaultFontColor = "black";
  Chart.defaults.global.defaultFontSize = 16;

  function HslColor (amount, item, saturation, lightness) {
    let huedelta = Math.trunc(540 / amount)
    let hue = item * huedelta
    return "hsl(" + hue + ", " + saturation + "%, " + lightness + "%)";
  };

  function renderChart(labels, datasets, currency) {
    var ctx = document.getElementById("EarningsChart").getContext('2d');
    var myChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: datasets
      },
      options: {
        legend: {
          labels: {
            // fontSize: 18
          }
        },
        scales: {
          xAxes: [
            {
              scaleLabel: {
                fontSize: 20,
                labelString: 'Date'
              },
              ticks: {
                // fontSize: 16
              },
              stacked: true
            }
          ],
          yAxes: [
            {
              scaleLabel: {
                display: 'true',
                fontSize: 20,
                labelString: currency
              },
              stacked: true,
              ticks: {
                // fontSize: 16
              }
            }
          ]
        },
        title: {
          display: true,
          fontSize: 32,
          fontStyle: 'normal',
          text: 'Daily Mining Earnings'
        },
        tooltips: {
          // titleFontSize: 16,
          // bodyFontSize: 16
        }
      }
    });
  }

  $(function() {
    function updateearningsdata() {
      $.ajax({
        url: '/earningschartdata', 
        success: function (earningsdata) {
          var datasets = [];

          for (var pool in earningsdata.Pools) {
            var BTCvalue = [];
            var BTCRate = [];
            for (var index in earningsdata.Pools[pool]) {
              BTCvalue.push(earningsdata.BTCrate * (earningsdata.Pools[pool][index]));
              BTCRate.push(earningsdata.Pools[pool][index]);
            };
            var earnings = {
              label: pool.replace('Internal', '(Internal)').replace('External', '(External)'),
              data: BTCvalue,
              backgroundColor: HslColor(Object.keys(earningsdata.Pools).length, datasets.length, 60, 66)
            };
            datasets.push(earnings);
          }
          renderChart(earningsdata.Labels, datasets, earningsdata.Currency);
        }
      });
    }
    updateearningsdata();

    window.setInterval(function() { 
      updateearningsdata();
    }, (parseInt(config.PoolBalancesUpdateInterval) * 60 * 1000));

  });

</script>

<!-- End of page scripts -->
<!--#include file="/parts/foot.html" -->