<!--#include file="/parts/head.html" -->
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 id="title" data-navbaractive="navearningstatistics" class="h2">Earning statistics</h1>
</div>

<div class="alert alert-info" role="alert">Earnings per pool of the last 30 active days.</div>

<canvas id="EarningsChart" width="400" height="175" role="img"></canvas>

<!-- Start of page scripts -->

<script type="text/javascript">

  function HslColor (saturation, lightness, amount, item) {
    let huedelta = Math.trunc(360 / amount)
    let hue = item * huedelta
    return "hsl(" + hue + ", " + saturation + "%, " + lightness + "%)";
  };

  function renderChart(labels, datasets, currency) {
    var ctx = document.getElementById("EarningsChart").getContext('2d');
    var myChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: datasets
      },
      options: {
        legend: {
          labels: {
            fontColor: 'black',
            fontSize: 18
          }
        },
        scales: {
          xAxes: [{
            ticks: {
              fontColor: 'black',
              fontSize: 16
            },
            stacked: true
          }],
          yAxes: [{
            stacked: true,
            ticks: {
              fontColor: 'black',
              fontSize: 16
            }
          }]
        },
        title: {
          display: true,
          fontSize: 32,
          fontStyle: 'normal',
          fontColor: 'black',
          text: 'Mining Earnings in ' + currency
        },
        tooltips: {
          titleFontSize: 16,
          bodyFontSize: 16
        }
      }
    });
  }

  $.ajax({url: '/earningschartdata', 
    success: function (earningsdata) {
      console.log(earningsdata);
      var datasets = [];
      for (var pool in earningsdata.Pools) {
        var label = pool.replace('Internal', ' (Internal)').replace('External', ' (External)');
        var data = [];
        for (var index in earningsdata.Pools[pool]) {
          data.push(earningsdata.BTCrate * (earningsdata.Pools[pool][index]));
        };

        var dataset = {
          label: label,
          data: data,
          backgroundColor: HslColor(50, 66, Object.keys(earningsdata.Pools).length, (datasets.length + 1))
        };
        datasets.push(dataset);
      }
      renderChart(earningsdata.Labels, datasets, earningsdata.Currency);
    }
  });

</script>

<!-- End of page scripts -->
<!--#include file="/parts/foot.html" -->