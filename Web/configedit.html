<!--#include file="/parts/head.html" -->
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 id="title" data-navbaractive="navconfigedit" class="h2">Edit Configuration</h1>
</div>

<div id="configfilename" class="alert alert-info" role="alert"></div>

<table>
  <div>
    <tr style="vertical-align: top;">
      <td>
        <label title="Your Bitcoin address (must be 34 chars long).  &#10;Do not enter a non-BTC address here. &#10;Payouts in other currencies must be configured manually in  &#10;PoolConfig.json as a per pool setting."for="wallet">BTC Wallet Address </label>
        <input title="Your Bitcoin address (must be 34 chars long).  &#10;Do not enter a non-BTC address here. &#10;Payouts in other currencies must be configured manually in  &#10;PoolConfig.json as a per pool setting." type="text" id="wallet" name="wallet" pattern="[0-9A-Za-z\-]{34}" value="1QGADhdMRpp9Pk5u5zG1TrHKRrdK5R81TE" size=34>
        <br><br>

        <label title="Identifies your worker &#10;e.g. Computername"for="workername">Worker Name </label>
        <input title="Identifies your worker &#10;e.g. Computername" type="text" id="workername" name="workername" size=32>
        <br><br>

        <label title="Your MiningPoolHub Username" for="mphusername">MPH User Name </label>
        <input title="Your MiningPoolHub Username" type="text" id="mphusername" name="mphusername" value="nemo">
        <br>
        <label title="Your MiningPoolHub API Key &#10;If left empty NemosMiner cannot retrieve balance data from MPH"for="mphapikey">MPH API Key </label>
        <input title="Your MiningPoolHub API Key &#10;If left empty NemosMiner cannot retrieve balance data from MPH" type="text" pattern="[0-9A-Fa-f\-]{64}" id="mphapikey" name="mphapikey" size=64>
        <br><br>

        <label title="Your NiceHash Bitcoin address (must be 34 chars long) &#10;configure only if different from BTC Wallet Address &#10" for="nicehashwallet">NiceHash BTC Wallet Address </label>
        <input title="Your NiceHash Bitcoin address (must be 34 chars long) &#10;configure only if different from BTC Wallet Address &#10" type="text" id="nicehashwallet" name="nicehashwallet" pattern="[0-9][A-Z][a-z]{34}" value="" size=34>
        <input title="Wallet is a NiceHsh internal wallet &#10;(lower pool fees)"type="checkbox" id="nicehashwalletisinternal" name="nicehashwalletisinternal" title="Wallet is a NiceHsh internal wallet &#10;(lower pool fees)">
        <label title="Wallet is a NiceHsh internal wallet &#10;(lower pool fees)" for="nicehashwalletisinternal" >is internal</label>
        <br>
        <label title="Your NiceHash API Key &#10;If left empty NemosMiner cannot retrieve balance data from NiceHash"for="nicehashapikey">NiceHash API Key </label>
        <input title="Your NiceHash API Key &#10;If left empty NemosMiner cannot retrieve balance data from NiceHash" type="text" pattern="[0-9A-Fa-f\-]{36}" id="nicehashapikey" name="nicehashapikey" size=36>
        <br>
        <label title="Your NiceHash API Secretey &#10;If left empty NemosMiner cannot retrieve balance data from NiceHash"for="nicehashapisecret">NiceHash API Secret </label>
        <input title="Your NiceHash API Secretey &#10;If left empty NemosMiner cannot retrieve balance data from NiceHash" type="text" pattern="[0-9A-Fa-f\-]{72}" id="nicehashapisecret" name="nicehashapisecret" size=72>
        <br>
        <label title="Your NiceHash Organization Id (must be 36 chars long) &#10;If left empty NemosMiner cannot retrieve balance data from NiceHash"for="nicehashorganizationid">NiceHash Organization Id </label>
        <input title="Your NiceHash Organization Id (must be 36 chars long) &#10;If left empty NemosMiner cannot retrieve balance data from NiceHash" type="text" pattern="[0-9A-Fa-f\-]{36}" id="nicehashorganizationid" name="nicehashorganizationid" size=36>
        <br><br>

        <label title="Your ProHashing Username"for="prohashingusername">ProHashing User Name </label>
        <input title="Your ProHashing Username" type="text" id="prohashingusername" name="prohashingusername" value="nemos">
        <br>
        <label title="Your ProHashing API key &#10;If left empty NemosMiner cannot retrieve balance data from ProHashing"for="prohashingapikey">ProHashing API key </label>
        <input title="Your ProHashing API key &#10;If left empty NemosMiner cannot retrieve balance data from ProHashing" type="text" pattern="[0-9A-Fa-f\-]{64}" id="prohashingapikey" name="prohashingapikey" size=64>
        <br><br>

        <label title="interval duration (between 30 & 3600 seconds) &#10;This defines the approximate duration for one cycle."for="interval">Interval (seconds) </label>
        <input title="interval duration (between 30 & 3600 seconds) &#10;This defines the approximate duration for one cycle." type="number" id="interval" name="interval" min="30" max="3600" value=90>
        <br>

        <label title="Donation duration per day (Default 13) &#10;(between 0 & 60 minutes) &#10;&#10;Please help support the great team behind NemosMiner &#10;by leaving mining donations turned on"for="donate">Donation (minutes) </label>
        <input title="Donation duration per day (Default 13) &#10;(between 0 & 60 minutes) &#10;&#10;Please help support the great team behind NemosMiner &#10;by leaving mining donations turned on" type="number" id="donate" name="donate" min="0" max="60" value=13>
        <br><br>

        <label for="algorithm">Algorithms </label>
        <input type="text" id="algorithm" name="algorithm" title="'+[algorithm]' to enable algorithm &#10;'-[algorithm]' to disable algorithm &#10;Values must be sparated by commas &#10;&#10;If '+' is used, then only the explicitly enabled algorithms are used &#10;If '-' is used, then all algorithms are used except the disabled ones &#10;Leave empty to use ALL available algorithms (not recommended as it may cause more switching)&#10;&#10;Do not combine '+' and '-' for the same algorithm" size=64>
        <button type="button" id="defaultalgorithm" name="defaultalgorithm" title="Load the default algorithm list &#10;for the selected pools">Load default algorithms</button>
        <br><br>

        <label for="currency">Currencies </label>
        <input type="text" id="currency" name="currency" value="mBTC" title="Fiat Currencies used for BTC conversion &#10;Values must be sparated by commas &#10;&#10;i.e. 'GBP, USD, AUD, NZD' ect.&#10;mBTC (milli BTC) is also valid &#10;The first value is used as main currency" size=64>
        <br>

        <label title="Default payout currency for all pools &#10;unless configured otherwise in PoolsConfig.json &#10;Note: Not all pools allow payouts in other currencies than BTC. &#10;Consult the pool API information for more information"for="PayoutCurrency">Default Payout Currency </label>
        <input title="Default payout currency for all pools &#10;unless configured otherwise in PoolsConfig.json &#10;Note: Not all pools allow payouts in other currencies than BTC. &#10;Consult the pool API information for more information"type="text" id="PayoutCurrency" name="PayoutCurrency" value="BTC" size=3>
        <br><br>

        <label title="Enter proxy IP address and port &#10;e.g. 192.168.1.1:3128"for="proxy">Proxy </label>
        <input type="text" id="proxy" name="proxy" title="Enter proxy IP address and port &#10;e.g. 192.168.1.1:3128" size=24>
        <br><br>

        <label title="Percent of advantage that running miner has &#10;over candidates in term of earning/profit &#10;&#10;Smaller numbers will cause more switching" for="runningminergainpct" >Running Miner Gain (%) </label>
        <input title="Percent of advantage that running miner has &#10;over candidates in term of earning/profit &#10;&#10;Smaller numbers will cause more switching" type="number" id="runningminergainpct" name="runningminergainpct" min="0" max="100" value=5>
        <br>
      </td>
      <td>
        <div class="col-md-12">
          <fieldset>
            <legend class=h6 title="You cannot select multiple variants of the same pool">Select one or more pools</legend>
            <div title="You cannot select multiple variants of the same pool" id="pools"></div>
          </fieldset>
        </div>
        <br>
        <div class="col-md-12">
          <fieldset>
            <legend class=h6>Select the region closest to your location</legend>
            <div title="NemosMiner will prefer pools from the selected region" id="regions"></div>
          </fieldset>
        </div>
      </td>
      <td>
        <div class="col-md-12">
          <fieldset>
            <legend class=h6>Miners selection</legend>
            <input type="checkbox" id="regularminers" name="regularminers" title="Miner definition files in folder '.\Miners'">
            <label for="regularminers" title="Miner definition files in folder '.\Miners'">Regular Miners</label>
            <br>
            <input type="checkbox" id="optionalminers" name="optionalminers" title="Miner definition files in folder '.\OptionalMiners'">
            <label for="optionalminers" title="Miner definition files in folder '.\OptionalMiners'">Optional Miners</label>
            <br>
          </fieldset>
          <br>
          <input type="checkbox" id="minerinstanceperdevicemodel" name="minerinstanceperdevicemodel" title="NemosMiner will create separate miner instances per device model. &#10;Recommended for rigs with mixed GPU types per manufacturer installed &#10;e.g. GTX 1060 & GTX 1070 &#10;This will increase profitability">
          <label for="minerinstanceperdevicemodel" title="NemosMiner will create separate miner instances per device model. &#10;Recommended for rigs with mixed GPU types per manufacturer installed &#10;e.g. GTX 1060 & GTX 1070 &#10;This will increase profitability">Miner Instance per Device Model</label>
          <br><br>
          <input type="checkbox" id="autostart" name="autostart" title="Automatically start mining when NemosMiner is started">
          <label for="autostart" title="Automatically start mining when NemosMiner is started">Auto Start</label>
          <br>
          <input type="checkbox" id="startpaused" name="startpaused" style="margin-left:20px" title="Start background processes, but do no not start mining when NemosMiner is started">
          <label for="startpaused" title="Start background processes, but do no not start mining when NemosMiner is started">Pause on Auto Start</label>
          <br>
          <input type="checkbox" id="minewhenidle" name="minewhenidle" title="Mine only when system is idle, e.g. no mouse or keyboard activity is detected">
          <label for="minewhenidle" title="Mine only when system is idle, e.g. no mouse or keyboard activity is detected">Mine only when system is idle for</label>
          <input title="Seconds the system must be idle befor mining starts" type="number" id="idlesec" name="idlesec" min="0" max="3600" value=120>
          <label for="idlesec" title="Seconds the system must be idle befor mining starts">seconds</label>
          <br><br>
          <label for="balancestrackerpollinterval" title="Interval duration to run background task to periodically collect pool balances & earnings data &#10;1 - 60 minutes; 0 to disable">Poll Pools for Earnings & Balances every </label>
          <input type="number" id="balancestrackerpollinterval" name="balancestrackerpollinterval" value=15 length=3 min=0 max=60 title="Interval duration to run background task to periodically collect pool balances & earnings data &#10;1 - 60 minutes; 0 to disable">
          <label for="balancestrackerpollinterval" title="Interval duration to run background task to periodically collect pool balances & earnings data &#10;1 - 60 minutes; 0 to disable">minutes</label>
          <br>
          <input type="checkbox" id="enablebalancestrackerlog" title="NemosMiner will store all earning data in .\Logs\EarningTrackerLog.csv" name="enablebalancestrackerlog" style="margin-left:20px">
          <label for="enablebalancestrackerlog" title="NemosMiner will store all earning data in .\Logs\EarningTrackerLog.csv">Earnings tracker Log</label>
          <br><br>
          <input type="checkbox" id="startguiminimized" name="startguiminimized">
          <label for="startguiminimized" title="">Start Legacy GUI minimized</label>
          <br>
          <input type="checkbox" id="hideminerwindows" name="hideminerwindows" title="Miners will run as a hidden background task. Not recommended!">
          <label for="hideminerwindows" title="Miners will run as a hidden background task. Not recommended!">Hide Miner Windows</label>
          <br><br>
          <input type="checkbox" id="watchdog" name="watchdog" title="Enable watchdog to suspend failing pools or miners for some cycles">
          <label for="watchdog" title="Enable watchdog to suspend failing pools or miners for some cycles">Watchdog</label>
          <br>
          <label for="watchdogmineralgorithmcount" title="Number of watchdog timers with same miner name & algorithm until miner/algo combination gets suspended" style="margin-left:20px">Watchdog (Miner & Algorithm) Count</label>
          <input title="Number of watchdog timers with same miner name & algorithm until miner/algo combination gets suspended" type="number" id="watchdogmineralgorithmcount" name="watchdogmineralgorithmcount" min="0" max="10" value=3>
          <br>
          <label for="watchdogminercount" title="Number of watchdog timers with same miner name until miner gets suspended" style="margin-left:20px">Watchdog (Miner) Count</label>
          <input title="Number of watchdog timers with same miner name until miner gets suspended" type="number" id="watchdogminercount" name="watchdogminercount" min="0" max="10" value=6>
          <br>
          <label for="watchdogpoolalgorithmcount" title="Number of watchdog timers with same pool name & algorithm until pool/algo combination gets suspended" style="margin-left:20px">Watchdog (Pool & Algorithm) Count</label>
          <input title="Number of watchdog timers with same pool name & algorithm until pool/algo combination gets suspended" type="number" id="watchdogpoolalgorithmcount" name="watchdogpoolalgorithmcount" min="0" max="100" value=3>
          <br>
          <label for="watchdogpoolcount" title="Number of watchdog timers with same pool name until pool gets suspended" style="margin-left:20px">Watchdog (Pool) Count</label>
          <input title="Number of watchdog timers with same pool name until pool gets suspended" type="number" id="watchdogpoolcount" name="watchdogpoolcount" min="0" max="10" value=7>
          <br><br>
          <input type="checkbox" id="estimatecorrection" name="estimatecorrection" title="NemosMiner will reduce the algo price by a correction factor (actual_last24h / estimate_last24h) to counter pool overestimated prices">
          <label for="estimatecorrection" title="NemosMiner will reduce the algo price by a correction factor (actual_last24h / estimate_last24h) to counter pool overestimated prices">Estimate Correction</label>
          <br><br>
          <input type="checkbox" id="autoupdate" title="Automatically update to the latest realeased program version" name="autoupdate">
          <label for="autoupdate" title="Automatically update to the latest realeased program version">Auto Update</label>
          <br>
        </div>
      </td>
    </tr>
  </div>
</table>

<button id="save-button" class="btn btn-primary">Save Configuration</button>

<!-- Start of page scripts -->

<script type="text/javascript">
  const poolscontainer = document.getElementById('pools');
  const regionscontainer = document.getElementById('regions');

  // Populate pool checkbox list
  var poolnames = [];
  $.ajax({url: '/poolnames',
    success: function(result) {
      poolnames = result;
      $.each(result, function (key, value) {
        $('<input/>', { type: 'checkbox', id: (value).toLowerCase(), value: value, title: title }).appendTo(poolscontainer);
        $('<label/>', { 'for': (value).toLowerCase(), text: (" " + value), title: "You cannot select multiple variants of the same pool" }).appendTo(poolscontainer);
        $('<br>').appendTo(poolscontainer);
      })
    }
  });

  // Fill region list
  var regions = [];
  var title = "Select the region closest to your location";
  $.ajax({url: '/regions',
    success: function(result) {
      regions = result;
      $.each(regions, function (key, value) {
        $('<input/>', { type: 'radio', id: (value).toLowerCase(), value: value, name: "region", title: title}).appendTo(regionscontainer);
        $('<label/>', { 'for': (value).toLowerCase(), text: (" " + value), title: "NemosMiner will prefer pools from the selected region" }).appendTo(regionscontainer);
        $('<br>').appendTo(regionscontainer);
      })
    }
  });

  // Get config file name
  $.ajax({url: '/configfile',
    success: function(result) {
      $('#configfilename').text("Current configuration file: '" + result + "'");
    }
  });

  // Get current config
  var config = {};
  $.ajax({url: '/config',
    success: function(result) {
      config = result;
      document.getElementById('wallet').value = config.Wallet;
      document.getElementById('workername').value = config.WorkerName;
      if (config.Interval == null) { 
        document.getElementById('interval').value = 90;
      } else {
        document.getElementById('interval').value = parseInt(config.Interval);
      }
      if (config.Donate == null) { 
        document.getElementById('donate').value = 13;
      } else {
        document.getElementById('donate').value = parseInt(config.Donate);
      }
      if (document.getElementById(config.Region.toLowerCase())) {
        document.getElementById(config.Region.toLowerCase()).checked = true;
      }
      if (config.Algorithm) {
        document.getElementById('algorithm').value = (config.Algorithm).toString();
      }
      document.getElementById('currency').value = config.Currency;
      document.getElementById('PayoutCurrency').value = config.PayoutCurrency;
      document.getElementById('proxy').value = config.Proxy;
      if (config.RunningMinerGainPc == null) { 
        document.getElementById('runningminergainpct').value = 5;
      } else {
        document.getElementById('runningminergainpct').value = parseInt(config.RunningMinerGainPct);
      }
      $.each(config.PoolName, function (key, value) {
        document.getElementById((value).toString().toLowerCase()).checked = true;
      });
      document.getElementById('mphapikey').value = config.MPHAPIKey;
      document.getElementById('mphapikey').disabled = !(document.getElementById('mph').checked);
      document.getElementById('mphusername').value = config.ProHashingUserName;
      document.getElementById('mphusername').disabled = !(document.getElementById('mph').checked);
      document.getElementById('nicehashapikey').value = config.NiceHashAPIKey;
      document.getElementById('nicehashapikey').disabled = !(document.getElementById('nicehash').checked);
      document.getElementById('nicehashapisecret').value = config.NiceHashAPISecret;
      document.getElementById('nicehashapisecret').disabled = !(document.getElementById('nicehash').checked);
      document.getElementById('nicehashwalletisinternal').checked = config.NiceHashWalletIsInternal;
      document.getElementById('nicehashwalletisinternal').disabled = !(document.getElementById('nicehash').checked);
      document.getElementById('nicehashwallet').value = config.NiceHashWallet;
      document.getElementById('nicehashwallet').disabled = !(document.getElementById('nicehash').checked);
      document.getElementById('nicehashorganizationid').value = config.NiceHashOrganizationId;
      document.getElementById('nicehashorganizationid').disabled = !(document.getElementById('nicehash').checked);
      document.getElementById('prohashingapikey').value = config.ProHashingAPIKey;
      document.getElementById('prohashingapikey').disabled = !(document.getElementById('prohashing24hr').checked);
      document.getElementById('prohashingusername').value = config.ProHashingUserName;
      document.getElementById('prohashingusername').disabled = !(document.getElementById('prohashing24hr').checked);
      if (config.IncludeOptionalMiners) {
        document.getElementById('optionalminers').checked = true;
      }
      if (config.IncludeRegularMiners) {
        document.getElementById('regularminers').checked = true;
      }
      if (config.MinerInstancePerDeviceModel) {
        document.getElementById('minerinstanceperdevicemodel').checked = true;
      }
      if (config.AutoStart) {
        document.getElementById('autostart').checked = true;
      } else {
        document.getElementById('startpaused').disabled = true;
      }
      if (config.StartPaused) {
        document.getElementById('startpaused').checked = true;
      }
      if (config.MineWhenIdle) {
        document.getElementById('minewhenidle').checked = true;
      } else {
        document.getElementById('idlesec').disabled = true;
      }
      if (config.IdleSec == null) { 
        document.getElementById('idlesec').value = 120;
      } else {
        document.getElementById('idlesec').value = parseInt(config.IdleSec);
      }
      document.getElementById('balancestrackerpollinterval').value = config.BalancesTrackerPollInterval;
      if (config.BalancesTrackerPollInterval == 0) {
        document.getElementById('enablebalancestrackerlog').diabled = true;
      }
      if (config.EnableBalancesTrackerLog) {
        document.getElementById('enablebalancestrackerlog').checked = true;
      }
      if (config.StartGUIMinimized) {
        document.getElementById('startguiminimized').checked = true;
      }
      if (config.HideMinerWindows) {
        document.getElementById('hideminerwindows').checked = true;
      }
      if (config.AutoUpdate) {
        document.getElementById('autoupdate').checked = true;
      }
      if (config.Watchdog) {
        document.getElementById('watchdog').checked = true;
      } else {
        document.getElementById('watchdogmineralgorithmcount').disabled = true;
        document.getElementById('watchdogminercount').disabled = true;
        document.getElementById('watchdogpoolalgorithmcount').disabled = true;
        document.getElementById('watchdogpoolcount').disabled = true;
      }
      if (config.WatchdogMinerAlgorithmCount == null) { 
        document.getElementById('watchdogmineralgorithmcount').value = 3;
      } else {
        document.getElementById('watchdogmineralgorithmcount').value = parseInt(config.WatchdogMinerAlgorithmCount);
      }
      if (config.WatchdogMinerCount == null) { 
        document.getElementById('watchdogminercount').value = 6;
      } else {
        document.getElementById('watchdogminercount').value = parseInt(config.WatchdogMinerCount);
      }
      if (config.WatchdogPoolAlgorithmCount == null) { 
        document.getElementById('watchdogpoolalgorithmcount').value = 3;
      } else {
        document.getElementById('watchdogpoolalgorithmcount').value = parseInt(config.WatchdogPoolAlgorithmCount);
      }
      if (config.WatchdogPoolCount == null) { 
        document.getElementById('watchdogpoolcount').value = 7;
      } else {
        document.getElementById('watchdogpoolcount').value = parseInt(config.WatchdogPoolCount);
      }
      if (config.EstimateCorrection) {
        document.getElementById('estimatecorrection').checked = true;
      }
    }
  });

  $('#save-button').click(function () {
    config.PoolName = []
    if ((document.getElementById('wallet').value).toString().trim() == "") {
      document.getElementById('wallet').value = '1QGADhdMRpp9Pk5u5zG1TrHKRrdK5R81TE';
    };
    config.Wallet = document.getElementById('wallet').value;
    config.WorkerName = document.getElementById('workername').value;
    if ((document.getElementById('mphusername').value).toString().trim() == "") {
      document.getElementById('mphusername').value = 'Nemo';
    };
    config.MPHAPIKey = document.getElementById('mphapikey').value;
    config.MPHUserName = document.getElementById('mphusername').value;
    config.NiceHashAPIKey = document.getElementById('nicehashapikey').value;
    config.NiceHashAPISecret = document.getElementById('nicehashapisecret').value;
    config.NiceHashWallet = document.getElementById('nicehashwallet').value;
    config.NiceHashWalletIsInternal = document.getElementById('nicehashwalletisinternal').checked;
    config.NiceHashOrganizationId = document.getElementById('nicehashorganizationid').value;
    config.ProHashingAPIKey = document.getElementById('prohashingapikey').value;
    config.ProHashingUserName = document.getElementById('prohashingusername').value;
    if (document.getElementById('interval').value == null) { 
      document.getElementById('interval').value = 90;
    };
    config.Interval = parseInt(document.getElementById('interval').value);
    if (document.getElementById('donate').value == null) { 
      document.getElementById('donate').value = 13;
    };
    config.Donate = parseInt(document.getElementById('donate').value);
    $.each(regions, function (key, value) {
      if (document.getElementById(value.toLowerCase()).checked == true) {
        config.Region = value;
      };
    });
    if (document.getElementById('algorithm').value == null) {
      document.getElementById('algorithm').value = 'mBTC';
    };
    config.Algorithm = document.getElementById('algorithm').value.split(',');
    if ((document.getElementById('currency').value).toString().trim() == null) {
      config.Currency = 'mBTC';
    };
    config.Currency = (document.getElementById('currency').value).toString().split(',');
    config.PayoutCurrency = document.getElementById('PayoutCurrency').value;
    config.Proxy = document.getElementById('proxy').value;
    if (document.getElementById('runningminergainpct').value == null) {
      document.getElementById('runningminergainpct').value = 5;
    };
    config.RunningMinerGainPct = parseInt(document.getElementById('runningminergainpct').value);
    $.each(poolnames, function (key, value) {
      if (document.getElementById(value.toLowerCase()).checked == true) {
        (config.PoolName).push(value);
      };
    });
    config.IncludeRegularMiners = document.getElementById('regularminers').checked;
    config.IncludeOptionalMiners = document.getElementById('optionalminers').checked;
    config.MinerInstancePerDeviceModel = document.getElementById('minerinstanceperdevicemodel').checked;
    config.AutoStart = document.getElementById('autostart').checked;
    config.StartPaused = document.getElementById('startpaused').checked;
    config.MineWhenIdle = document.getElementById('minewhenidle').checked;
    if (document.getElementById('idlesec').value == null) { 
      document.getElementById('idlesec').value = 120;
    };
    config.IdleSec = parseInt(document.getElementById('idlesec').value);
    config.BalancesTrackerPollInterval = document.getElementById('balancestrackerpollinterval').value;
    config.EnableBalancesTrackerLog = document.getElementById('enablebalancestrackerlog').checked;
    config.StartGUIMinimized = document.getElementById('startguiminimized').checked;
    config.HideMinerWindows = document.getElementById('hideminerwindows').checked;
    config.Watchdog = document.getElementById('watchdog').checked;
    if (document.getElementById('watchdogmineralgorithmcount').value == null) { 
      document.getElementById('watchdogmineralgorithmcount').value = 120;
    };
    config.WatchdogMinerAlgorithmCount = parseInt(document.getElementById('watchdogmineralgorithmcount').value);
    if (document.getElementById('watchdogminercount').value == null) { 
      document.getElementById('watchdogminercount').value = 120;
    };
    config.WatchdogMinerCount = parseInt(document.getElementById('watchdogminercount').value);
    if (document.getElementById('watchdogpoolalgorithmcount').value == null) { 
      document.getElementById('watchdogpoolalgorithmcount').value = 120;
    };
    config.WatchdogPoolAlgorithmCount = parseInt(document.getElementById('watchdogpoolalgorithmcount').value);
    if (document.getElementById('watchdogpoolcount').value == null) { 
      document.getElementById('watchdogpoolcount').value = 120;
    };
    config.WatchdogPoolCount = parseInt(document.getElementById('watchdogpoolcount').value);
    config.EstimateCorrection = document.getElementById('estimatecorrection').checked;
    config.AutoUpdate = document.getElementById('autoupdate').checked;

    //Write current config
    var $command = '/functions/config/set?' + encodeURIComponent(JSON.stringify(config));
    $('.modal-body').load($command, function() {
      $('.modal-title').text($('#save-button').text());
      $('#myModal').modal({show:true});
    });
  });

  // Only one pool variant can be checked
  const pools = document.getElementById('pools');
  $(pools).click(function(event) {
    if ((event.target).value) {
      var poolname = (event.target).id.toLowerCase();
    }
    var basepoolname = (poolname.replace('24hr', '')).replace('coins', '');

    var pool = document.getElementById(basepoolname);
    if (pool && poolname != pool.id) {
      pool.checked = false;
    }

    var pool = document.getElementById(basepoolname + '24hr');
    if (pool && poolname != pool.id) {
      pool.checked = false;
    }

    var pool = document.getElementById(basepoolname + 'coins');
    if (pool && poolname != pool.id) {
      pool.checked = false;
    }

    if (poolname == 'mph') {
      document.getElementById(poolname + 'username').disabled = !(document.getElementById(poolname).checked);
      document.getElementById(poolname + 'apikey').disabled = !(document.getElementById(poolname).checked);
    }
    if (poolname == 'nicehash') {
      document.getElementById('nicehashapikey').disabled = !(document.getElementById(poolname).checked);
      document.getElementById('nicehashapisecret').disabled = !(document.getElementById(poolname).checked);
      document.getElementById('nicehashwallet').disabled = !(document.getElementById(poolname).checked);
      document.getElementById('nicehashwalletisinternal').disabled = !(document.getElementById(poolname).checked);
      document.getElementById('nicehashorganizationid').disabled = !(document.getElementById(poolname).checked);
    }
    if (poolname == 'prohashing24hr') {
      document.getElementById('prohashingusername').disabled = !(document.getElementById(poolname).checked);
      document.getElementById('prohashingapikey').disabled = !(document.getElementById(poolname).checked);
    }

  });

  //startpaused
  $(document.getElementById('autostart')).click(function(event) {
    document.getElementById('startpaused').disabled = !(document.getElementById('autostart').checked);
  });

  //idlesec
  $(document.getElementById('minewhenidle')).click(function(event) {
    document.getElementById('idlesec').disabled = !(document.getElementById('minewhenidle').checked);
  });

  //enablebalancestrackerlog
  $(document.getElementById('balancestrackerpollinterval')).click(function(event) {
    document.getElementById('enablebalancestrackerlog').disabled = !(document.getElementById('balancestrackerpollinterval').value != 0);
  });

  //Watchdog sub item
  $(document.getElementById('watchdog')).click(function(event) {
    document.getElementById('watchdogmineralgorithmcount').disabled = !(document.getElementById('watchdog').checked);
    document.getElementById('watchdogminercount').disabled = !(document.getElementById('watchdog').checked);
    document.getElementById('watchdogpoolalgorithmcount').disabled = !(document.getElementById('watchdog').checked);
    document.getElementById('watchdogpoolcount').disabled = !(document.getElementById('watchdog').checked);
  });

  //Load default algorithm list
  $('#defaultalgorithm').click(function () {
    $.ajax({url: '/defaultalgorithm',
      success: function(result) {
        algorithm.value = "+" + result.join(",+");
      }
    });
  });

</script>

<!-- End of page scripts -->
<!--#include file="/parts/foot.html" -->