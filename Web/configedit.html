<!--#include file="/parts/head.html" -->
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 id="title" data-navbaractive="navconfigedit" class="h2">Edit Configuration</h1>
</div>

<div id="configfilename" class="alert alert-info" role="alert"></div>

<table>
  <div>
    <tr style="vertical-align: top;">
      <td>
        <label title="Your Bitcoin address (must be 34 chars long). &#10;Do not enter a non-BTC address here. &#10; &#10;Payouts in other currencies must be configured as a per pool setting &#10;by editing '.\Config\PoolConfig.json'." for="Wallet">BTC wallet address</label>
        <input title="Your Bitcoin address (must be 34 chars long). &#10;Do not enter a non-BTC address here. &#10; &#10;Payouts in other currencies must be configured as a per pool setting &#10;by editing '.\Config\PoolConfig.json'." type="text" id="Wallet" name="Wallet" pattern="[0-9A-Za-z\-]{34}" value="1QGADhdMRpp9Pk5u5zG1TrHKRrdK5R81TE" size=34>
        <br><br>

        <label title="Identifies your worker &#10;e.g. Computername" for="WorkerName">Worker name</label>
        <input title="Identifies your worker &#10;e.g. Computername" type="text" id="WorkerName" name="WorkerName" size=32>
        <br><br>

        <label title="Your MiningPoolHub username &#10;Note: The username must be registered with MPH" for="MPHUserName">MPH user name</label>
        <input title="Your MiningPoolHub username &#10;Note: The username must be registered with MPH" type="text" id="MPHUserName" name="MPHUserName" value="nemo">
        <br>
        <label title="Your MiningPoolHub API Key &#10;If left empty NemosMiner cannot retrieve balance data from MPH" for="MPHAPIKey">MPH API Key</label>
        <input title="Your MiningPoolHub API Key &#10;If left empty NemosMiner cannot retrieve balance data from MPH" type="text" pattern="[0-9A-Fa-f\-]{64}" id="MPHAPIKey" name="MPHAPIKey" size=64>
        <br><br>

        <label title="Your NiceHash Bitcoin address (must be 34 chars long) &#10;configure only if different from BTC Wallet Address &#10" for="NiceHashWallet">NiceHash BTC wallet address</label>
        <input title="Your NiceHash Bitcoin address (must be 34 chars long) &#10;configure only if different from BTC Wallet Address &#10" type="text" id="NiceHashWallet" name="NiceHashWallet" pattern="[0-9][A-Z][a-z]{34}" value="" size=34>
        <input title="Wallet is a NiceHash internal Wallet &#10;(lower pool fees)" type="checkbox" id="NiceHashWalletIsInternal" name="NiceHashWalletIsInternal" title="Wallet is a NiceHash internal Wallet &#10;(lower pool fees)">
        <label title="Wallet is a NiceHash internal Wallet &#10;(lower pool fees)" for="NiceHashWalletIsInternal" >is internal</label>
        <br>
        <label title="Your NiceHash API Key &#10;If left empty NemosMiner cannot retrieve balance data from NiceHash" for="NiceHashAPIKey">NiceHash API Key</label>
        <input title="Your NiceHash API Key &#10;If left empty NemosMiner cannot retrieve balance data from NiceHash" type="text" pattern="[0-9A-Fa-f\-]{36}" id="NiceHashAPIKey" name="NiceHashAPIKey" size=36>
        <br>
        <label title="Your NiceHash API Secret Key &#10;If left empty NemosMiner cannot retrieve balance data from NiceHash" for="NiceHashAPISecret">NiceHash API Secret</label>
        <input title="Your NiceHash API Secret Key &#10;If left empty NemosMiner cannot retrieve balance data from NiceHash" type="text" pattern="[0-9A-Fa-f\-]{72}" id="NiceHashAPISecret" name="NiceHashAPISecret" size=72>
        <br>
        <label title="Your NiceHash Organization Id (must be 36 chars long) &#10;If left empty NemosMiner cannot retrieve balance data from NiceHash" for="NiceHashOrganizationId">NiceHash Organization Id</label>
        <input title="Your NiceHash Organization Id (must be 36 chars long) &#10;If left empty NemosMiner cannot retrieve balance data from NiceHash" type="text" pattern="[0-9A-Fa-f\-]{36}" id="NiceHashOrganizationId" name="NiceHashOrganizationId" size=36>
        <br><br>

        <label title="Your ProHashing username &#10;Note: The username must be registered with ProHashing" for="ProHashingUserName">ProHashing user name</label>
        <input title="Your ProHashing username &#10;Note: The username must be registered with ProHashing" type="text" id="ProHashingUserName" name="ProHashingUserName" value="nemos">
        <br>
        <label title="Your ProHashing API key &#10;If left empty NemosMiner cannot retrieve balance data from ProHashing" for="ProHashingAPIKey">ProHashing API key</label>
        <input title="Your ProHashing API key &#10;If left empty NemosMiner cannot retrieve balance data from ProHashing" type="text" pattern="[0-9A-Fa-f\-]{64}" id="ProHashingAPIKey" name="ProHashingAPIKey" size=64>
        <br><br>

        <label title="Cycle duration (between 30 & 3600 seconds) &#10;This defines the approximate duration for one cycle." for="Interval">Cycle duration</label>
        <input title="Cycle duration (between 30 & 3600 seconds) &#10;This defines the approximate duration for one cycle." type="number" id="Interval" name="Interval" min="30" max="3600" value=90>
        <label title="Cycle duration (between 30 & 3600 seconds) &#10;This defines the approximate duration for one cycle." for="Interval">seconds</label>
        <br>

        <label title="(between 0 & 60 minutes) &#10;Default donation duration per day is 13 minutes (0.9%) &#10;&#10;Please help support the great team behind NemosMiner &#10;by leaving mining donations turned on" for="Donate">Donation duration per day</label>
        <input title="(between 0 & 60 minutes) &#10;Default donation duration per day is 13 minutes (0.9%) &#10;&#10;Please help support the great team behind NemosMiner &#10;by leaving mining donations turned on" type="number" id="Donate" name="Donate" min="0" max="60" value=13>
        <label title="(between 0 & 60 minutes) &#10;Default donation duration per day is 13 minutes (0.9%) &#10;&#10;Please help support the great team behind NemosMiner &#10;by leaving mining donations turned on" for="Donate">minutes</label>
        <br><br>

        <label for="Algorithm">Algorithms</label>
        <input type="text" id="Algorithm" name="Algorithm" title="'+[Algorithm]' to enable algorithm &#10;'-[Algorithm]' to disable Algorithm &#10;Values must be sparated by commas &#10;&#10;If '+' is used, then only the explicitly enabled Algorithms are used &#10;If '-' is used, then all Algorithms are used except the disabled ones &#10;Leave empty to use ALL available Algorithms (not recommended as it may cause more switching) &#10;&#10;Do not combine '+' and '-' for the same Algorithm &#10;&#10;Note: This is also a per pool configuration item (edit .'\Config\PoolsConfig.json')" size=64>
        <button type="button" id="defaultAlgorithm" name="defaultAlgorithm" title="Load the default algorithm list &#10;for the selected pools">Load default algorithms</button>
        <br><br>

        <label for="Currency">Currencies</label>
        <input type="text" id="Currency" name="Currency" value="mBTC" title="Fiat Currencies used for BTC conversion &#10;Values must be sparated by commas &#10;&#10;i.e. 'GBP, USD, AUD, NZD' ect.&#10;mBTC (milli BTC) is also valid &#10;The first value is used as main Currency" size=64>
        <br>

        <label title="Default payout Currency for all pools &#10;Important: Not all pools allow payouts in other currencies than BTC. &#10;Consult the pool API information for more information &#10;&#10;Note: This is also a per pool configuration item (edit .'\Config\PoolsConfig.json')" for="PayoutCurrency">Default Payout Currency</label>
        <input title="Default payout Currency for all pools &#10;Important: Not all pools allow payouts in other currencies than BTC. &#10;Consult the pool API information for more information &#10;&#10;Note: This is also a per pool configuration item (edit .'\Config\PoolsConfig.json')" type="text" id="PayoutCurrency" name="PayoutCurrency" value="BTC" size=3>
        <br><br>

        <label title="Enter Proxy IP address and port &#10;e.g. 192.168.1.1:3128" for="Proxy">Proxy</label>
        <input type="text" id="Proxy" name="Proxy" title="Enter Proxy IP address and port &#10;e.g. 192.168.1.1:3128" size=24>
        <br><br>

        <label title="As long as no other miner has earning/profit that are &#10;n% higher than the current miner it will not switch &#10;&#10;Smaller numbers will cause more switching" for="RunningMinerGainPct" >Running Miner Gain</label>
        <input title="As long as no other miner has earning/profit that are &#10;n% higher than the current miner it will not switch &#10;&#10;Smaller numbers will cause more switching" type="number" id="RunningMinerGainPct" name="RunningMinerGainPct" min="0" max="100" value=5>
        <label title="As long as no other miner has earning/profit that are &#10;n% higher than the current miner it will not switch &#10;&#10;Smaller numbers will cause more switching" for="RunningMinerGainPct" >%</label>
        <br>
      </td>
      <td>
        <div class="col-md-12">
          <fieldset>
            <legend class=h6 title="You cannot select multiple variants of the same pool">Select one or more pools</legend>
            <div title="You cannot select multiple variants of the same pool" id="Pools"></div>
          </fieldset>
        </div>
        <br>
        <div class="col-md-12">
          <fieldset>
            <legend class=h6 title="NemosMiner will prefer pools from the selected region">Select the region closest to your location</legend>
            <div id="Regions"></div>
          </fieldset>
        </div>
        <br>
        <input title="Calculate power cost, required for true profit calculation &#10;Requires extra configuration of HWiNFO64 &#10;(See ConfigHWinfo64.pdf)" type="checkbox" id="CalculatePowerCost" name="CalculatePowerCost" title="Wallet is a NiceHash internal Wallet &#10;(lower pool fees)">
        <label title="Calculate power cost, required for true profit calculation &#10;Requires extra configuration of HWiNFO64 &#10;(See ConfigHWinfo64.pdf)" for="CalculatePowerCost" >Calculate Power Cost</label>
        <br>
        <label style="margin-left:20px" title='Price of power per kW⋅h (in $Currency[0], e.g. USD), valid from HH:mm (24hr format) as compressed json &#10;&#10;e.g. { "00:00":0.26; "12:00":0.3 } &#10;From midnight to noon: 0.26 USD per kW/h  &#10;from noon to midnight USD 0.30 per kW/h' for="PowerPricekWh">Power Price</label>
        <input type="text" id="PowerPricekWh" name="PowerPricekWh" title='Price of power per kW⋅h (in $Currency[0], e.g. CHF), valid from HH:mm (24hr format) as compressed json &#10;&#10;e.g. { "00:00":0.26; "12:00":0.3 } &#10;From midnight to noon: USD 0.26 per kW/h  &#10;from noon to midnight USD 0.30 per kW/h' size=24>
        <label title='Price of power per kW⋅h (in $Currency[0], e.g. USD), valid from HH:mm (24hr format) as compressed json &#10;&#10;e.g. { "00:00":0.26; "12:00":0.3 } &#10;From midnight to noon: 0.26 USD per kW/h  &#10;from noon to midnight USD 0.30 per kW/h' for="PowerPricekWh">per kW/h</label>
        <br>
        <input style="margin-left:20px" title="NemosMiner will ignore power cost in best miner selection &#10;instead miners with best earnings will be selected" type="checkbox" id="IgnorePowerCost" name="IgnorePowerCost" title="Wallet is a NiceHash internal Wallet &#10;(lower pool fees)">
        <label title="NemosMiner will ignore power cost in best miner selection &#10;instead miners with best earnings will be selected" for="IgnorePowerCost" >Ignore Power Cost</label>
        <br>
        <label style="margin-left:20px" title="If profit (earnings - power cost) is less than the configured value &#10;(in $Currency, e.g. CHF, e.g. 1.00) then mining will stop &#10;(except for benchmarking & power usage measuring) &#10;use negative numbers to allow mining at loss" for="ProfitabilityThreshold">Profitability Threshold</label>
        <input title="If profit (earnings - power cost) is less than the configured value &#10;(in $Currency, e.g. CHF, e.g. 1.00) then mining will stop &#10;(except for benchmarking & power usage measuring) &#10;use negative numbers to allow mining at loss" type="text" id="ProfitabilityThreshold" name="ProfitabilityThreshold" size=6>
        <br><br>
        <label title="Mark pool as unavailable if the price reported by the pool &#10;is X times higher than the average price reported by all other pools &#10;(min=1, max=10)" for="UnrealPoolPriceFactor">Unreal Pool Price Factor</label>
        <input type="number" step="0.1" min="1" max="10" value=5 id="UnrealPoolPriceFactor" name="UnrealPoolPriceFactor" title="Mark pool as unavailable if the price reported by the pool &#10;is X times higher than the average price reported by all other pools &#10;(min=1, max=10)">
      </td>

      <td>
        <div class="col-md-12">
          <fieldset>
            <legend class=h6>Miners selection</legend>
            <input type="checkbox" id="RegularMiners" name="RegularMiners" title="Miner definition files in folder '.\Miners'">
            <label for="RegularMiners" title="Miner definition files in folder '.\Miners'">Regular Miners</label>
            <br>
            <input type="checkbox" id="OptionalMiners" name="OptionalMiners" title="Miner definition files in folder '.\OptionalMiners'">
            <label for="OptionalMiners" title="Miner definition files in folder '.\OptionalMiners'">Optional Miners</label>
            <br>
          </fieldset>
          <br>
          <input type="checkbox" id="MinerInstancePerDeviceModel" name="MinerInstancePerDeviceModel" title="NemosMiner will run separate miner instances per device model. &#10;Recommended for rigs with mixed GPU types per manufacturer installed &#10;e.g. GTX 1060 & GTX 1070 &#10;This will increase profitability">
          <label for="MinerInstancePerDeviceModel" title="NemosMiner will run separate miner instances per device model. &#10;Recommended for rigs with mixed GPU types per manufacturer installed &#10;e.g. GTX 1060 & GTX 1070 &#10;This will increase profitability">Run miner instance per device model</label>
          <br>
          <input type="checkbox" id="DisableMinerFees" name="DisableMinerFees" title="NemosMiner will disable miner fees &#10;(Note: not all miners support turning off their built in fees, others will reduce the hashrate)">
          <label for="DisableMinerFees" title="NemosMiner will disable miner fees &#10;(Note: not all miners support turning off their built in fees, others will reduce the hashrate)">Disable Miner Fees</label>
          <br>
          <input type="checkbox" id="DisableMinersWithFees" name="DisableMinersWithFees" title="NemosMiner will disable all miners which contain fees">
          <label for="DisableMinersWithFees" title="NemosMiner will disable all miners which contain fees">Do not use Miner which contain Fees</label>
          <br>
          <input type="checkbox" id="DisableDualAlgoMining" name="DisableDualAlgoMining" title="NemosMiner will disable all dual algorithm miners &#10;(Note: This will enable single algorithm mining)">
          <label for="DisableDualAlgoMining" title="NemosMiner will disable all dual algorithm miners &#10;(Note: This will enable single algorithm mining)">Disable Dual Algorithm Miners</label>
          <br>
          <input type="checkbox" id="DisableSingleAlgoMining" name="DisableSingleAlgoMining" title="NemosMiner will disable all single algorithm miners &#10;(Note: This will enable dual algorithm mining)">
          <label for="DisableSingleAlgoMining" title="NemosMiner will disable all single algorithm miners &#10;(Note: This will enable dual algorithm mining)">Disable Single Algorithm Miners</label>
          <br><br>
          <input type="checkbox" id="AutoStart" name="AutoStart" title="Automatically start mining when NemosMiner is started">
          <label for="AutoStart" title="Automatically start mining when NemosMiner is started">Auto Start</label>
          <br>
          <input type="checkbox" id="StartPaused" name="StartPaused" style="margin-left:20px" title="Start background processes, but do no not start mining when NemosMiner is started">
          <label for="StartPaused" title="Start background processes, but do no not start mining when NemosMiner is started">Pause mining on Auto Start</label>
          <br>
          <input type="checkbox" id="MineWhenIdle" name="MineWhenIdle" title="Mine only when system is idle, e.g. no mouse or keyboard activity is detected">
          <label for="MineWhenIdle" title="Mine only when system is idle, e.g. no mouse or keyboard activity is detected">Mine only when system is idle for</label>
          <input title="Seconds the system must be idle until mining starts" type="number" id="IdleSec" name="IdleSec" min="0" max="3600" value=120>
          <label for="IdleSec" title="Seconds the system must be idle until mining starts">seconds</label>
          <br><br>
          <label for="BalancesTrackerPollInterval" title="Interval duration to run background task to periodically collect pool balances & earnings data &#10;1 - 60 minutes; 0 to disable">Poll Pools for Earnings & Balances every</label>
          <input type="number" id="BalancesTrackerPollInterval" name="BalancesTrackerPollInterval" value=15 length=3 min=0 max=60 title="Interval duration to run background task to periodically collect pool balances & earnings data &#10;1 - 60 minutes; 0 to disable">
          <label for="BalancesTrackerPollInterval" title="Interval duration to run background task to periodically collect pool balances & earnings data &#10;1 - 60 minutes; 0 to disable">minutes</label>
          <br>
          <input type="checkbox" id="EnableBalancesTrackerLog" title="NemosMiner will store all earning data in .\Logs\EarningTrackerLog.csv" name="EnableBalancesTrackerLog" style="margin-left:20px">
          <label for="EnableBalancesTrackerLog" title="NemosMiner will store all earning data in .\Logs\EarningTrackerLog.csv">Earnings tracker Log</label>
          <br><br>
          <input type="checkbox" id="StartGUIMinimized" name="StartGUIMinimized">
          <label for="StartGUIMinimized" title="">Start Legacy GUI minimized</label>
          <br><br>
          <legend class=h6>Show Miner Windows</legend>
          <input title="Miners will run as a hidden background task and are not accessible (not recommended)" type="radio" id="ShowMinerWindowsHidden" name="ShowMinerWindows" value="Hidden">
          <label title="Miners will run as a hidden background task and are not accessible (not recommended)" for="ShowMinerWindowsHidden">Hidden</label><br>
          <input title="Miner windows are minimized (default), but accessible" type="radio" id="ShowMinerWindowsMinimized" name="ShowMinerWindows" value="Minimized">
          <label title="Miner windows are minimized (default), but accessible"for="ShowMinerWindowsMinimized">Minimized</label><br>
          <input title="Miner windows are shown normally on desktop" type="radio" id="ShowMinerWindowsNormal" name="ShowMinerWindows" value="Normal">
          <label title="Miner windows are shown normally on desktop" for="ShowMinerWindowsNormal">Normal</label>
          <br><br>
          <input type="checkbox" id="Watchdog" name="Watchdog" title="Enable watchdog to suspend failing pools or miners for some cycles">
          <label for="Watchdog" title="Enable watchdog to suspend failing pools or miners for some cycles">Watchdog</label>
          <br>
          <label for="WatchdogMinerAlgorithmCount" title="Number of watchdog timers with same miner name & algorithm until miner/algorithm combination gets suspended" style="margin-left:20px">Watchdog (Miner & Algorithm) count</label>
          <input title="Number of watchdog timers with same miner name & algorithm until miner/algorithm combination gets suspended" type="number" id="WatchdogMinerAlgorithmCount" name="WatchdogMinerAlgorithmCount" min="0" max="10" value=3>
          <br>
          <label for="WatchdogMinerCount" title="Number of watchdog timers with same miner name until miner gets suspended" style="margin-left:20px">Watchdog (Miner) count</label>
          <input title="Number of watchdog timers with same miner name until miner gets suspended" type="number" id="WatchdogMinerCount" name="WatchdogMinerCount" min="0" max="10" value=6>
          <br>
          <label for="WatchdogPoolAlgorithmCount" title="Number of watchdog timers with same pool name & algorithm until pool/algorithm combination gets suspended" style="margin-left:20px">Watchdog (Pool & Algorithm) count</label>
          <input title="Number of watchdog timers with same pool name & algorithm until pool/algorithm combination gets suspended" type="number" id="WatchdogPoolAlgorithmCount" name="WatchdogPoolAlgorithmCount" min="0" max="100" value=3>
          <br>
          <label for="WatchdogPoolCount" title="Number of watchdog timers with same pool name until pool gets suspended" style="margin-left:20px">Watchdog (Pool) count</label>
          <input title="Number of watchdog timers with same pool name until pool gets suspended" type="number" id="WatchdogPoolCount" name="WatchdogPoolCount" min="0" max="10" value=7>
          <br><br>
          <input type="checkbox" id="EstimateCorrection" name="EstimateCorrection" title="NemosMiner will reduce the profitability (as reported by the pool) by &#10;a correction factor (actual_last24h / estimate_last24h) &#10;to counter pool overestimated profitability">
          <label for="EstimateCorrection" title="NemosMiner will reduce the profitability (as reported by the pool) by &#10;a correction factor (actual_last24h / estimate_last24h) &#10;to counter pool overestimated profitability">Use Estimate Correction</label>
          <br><br>
          <input type="checkbox" id="ApplyUnprofitableAlgorithmList" name="ApplyUnprofitableAlgorithmList" title="NemosMiner will not mine algorithms listed in &#10;UnprofitableAlgorithms.txt (recommended)">
          <label for="ApplyUnprofitableAlgorithmList" title="NemosMiner will not mine algorithms listed in &#10;UnprofitableAlgorithms.txt (recommended)">Do not mine algorithms in the Unprofitable Algorithms List</label>
          <br><br>
          <input type="checkbox" id="AutoUpdate" title="Automatically update to the latest realeased program version" name="AutoUpdate">
          <label for="AutoUpdate" title="Automatically update to the latest realeased program version">Auto Update</label>
          <br>
        </div>
      </td>
    </tr>
  </div>
</table>

<button id="save-button" class="btn btn-primary">Apply Configuration</button>

<!-- Start of page scripts -->

<script type="text/javascript">
  const poolscontainer = document.getElementById('Pools');
  const regionscontainer = document.getElementById('Regions');

  // Populate pool checkbox list
  var poolnames = [];
  $.ajax({url: '/poolnames',
    success: function(result) {
      poolnames = result;
      $.each(poolnames, function (key, value) {
        $('<input/>', { type: 'checkbox', id: (value).toLowerCase(), value: value, title: title }).appendTo(poolscontainer);
        $('<label/>', { 'for': (value).toLowerCase(), text: (" " + value), title: "You cannot select multiple variants of the same pool" }).appendTo(poolscontainer);
        $('<br>').appendTo(poolscontainer);
      })
    }
  });

  // Fill region list
  var regions = [];
  $.ajax({url: '/regions',
    success: function(result) {
      regions = result;
      $.each(regions, function (key, value) {
        $('<input/>', { type: 'radio', id: (value).toLowerCase(), value: value, name: "Region", title: "NemosMiner will prefer pools from the selected region"}).appendTo(regionscontainer);
        $('<label/>', { 'for': (value).toLowerCase(), text: (" " + value), title: "NemosMiner will prefer pools from the selected region" }).appendTo(regionscontainer);
        $('<br>').appendTo(regionscontainer);
      })
    }
  });

  // Get config file name
  $.ajax({url: '/configfile',
    success: function(result) {
      $('#configfilename').text("Current configuration file: '" + result + "'");
    }
  });

  // Get current config
  var config = {};
  $.ajax({url: '/config',
    success: function(result) {
      config = result;
      document.getElementById('Wallet').value = config.Wallet;
      document.getElementById('WorkerName').value = config.WorkerName;
      if (config.Interval == null) { 
        document.getElementById('Interval').value = 90;
      } else {
        document.getElementById('Interval').value = parseInt(config.Interval);
      }
      if (config.Donate == null) { 
        document.getElementById('Donate').value = 13;
      } else {
        document.getElementById('Donate').value = parseInt(config.Donate);
      }
      if (config.Algorithm) {
        document.getElementById('Algorithm').value = (config.Algorithm).toString();
      }
      document.getElementById('Currency').value = config.Currency;
      document.getElementById('PayoutCurrency').value = config.PayoutCurrency;
      document.getElementById('Proxy').value = config.Proxy;
      if (config.RunningMinerGainPct == null) { 
        document.getElementById('RunningMinerGainPct').value = 5;
      } else {
        document.getElementById('RunningMinerGainPct').value = parseInt(config.RunningMinerGainPct);
      }

      $.each(config.PoolName, function (key, value) {
        document.getElementById((value).toString().toLowerCase()).checked = true;
      });
      if (document.getElementById(config.Region.toLowerCase())) {
        document.getElementById(config.Region.toLowerCase()).checked = true;
      }
      if (config.CalculatePowerCost) {
        document.getElementById('CalculatePowerCost').checked = true;
      }
      document.getElementById('PowerPricekWh').value = JSON.stringify(config.PowerPricekWh);
      if (config.IgnorePowerCost) {
        document.getElementById('IgnorePowerCost').checked = true;
      }
      document.getElementById('ProfitabilityThreshold').value = config.ProfitabilityThreshold;
      document.getElementById('UnrealPoolPriceFactor').value = parseFloat(config.UnrealPoolPriceFactor);

      if (config.IncludeOptionalMiners) {
        document.getElementById('OptionalMiners').checked = true;
      }
      if (config.IncludeRegularMiners) {
        document.getElementById('RegularMiners').checked = true;
      }
      if (config.MinerInstancePerDeviceModel) {
        document.getElementById('MinerInstancePerDeviceModel').checked = true;
      }
      if (config.DisableMinerFees) {
        document.getElementById('DisableMinerFees').checked = true;
      }
      if (config.DisableMinersWithFees) {
        document.getElementById('DisableMinersWithFees').checked = true;
      }
      if (config.DisableDualAlgoMining) {
        document.getElementById('DisableDualAlgoMining').checked = true;
      }
      if (config.DisableSingleAlgoMining) {
        document.getElementById('DisableSingleAlgoMining').checked = true;
      }
      if (config.AutoStart) {
        document.getElementById('AutoStart').checked = true;
      } else {
        document.getElementById('StartPaused').disabled = true;
      }
      if (config.StartPaused) {
        document.getElementById('StartPaused').checked = true;
      }
      if (config.MineWhenIdle) {
        document.getElementById('MineWhenIdle').checked = true;
      } else {
        document.getElementById('IdleSec').disabled = true;
      }
      if (config.IdleSec == null) { 
        document.getElementById('IdleSec').value = 120;
      } else {
        document.getElementById('IdleSec').value = parseInt(config.IdleSec);
      }
      document.getElementById('BalancesTrackerPollInterval').value = config.BalancesTrackerPollInterval;
      if (config.BalancesTrackerPollInterval == 0) {
        document.getElementById('EnableBalancesTrackerLog').diabled = true;
      }
      if (config.EnableBalancesTrackerLog) {
        document.getElementById('EnableBalancesTrackerLog').checked = true;
      }
      if (config.StartGUIMinimized) {
        document.getElementById('StartGUIMinimized').checked = true;
      }
      if (config.ShowMinerWindows.toLowerCase() == "hidden") {
        document.getElementById('ShowMinerWindowsHidden').checked = true;
      }
      if (config.ShowMinerWindows.toLowerCase() == "minimized") {
        document.getElementById('ShowMinerWindowsMinimized').checked = true;
      }
      if (config.ShowMinerWindows.toLowerCase() == "normal") {
        document.getElementById('ShowMinerWindowsNormal').checked = true;
      }
      if (config.AutoUpdate) {
        document.getElementById('AutoUpdate').checked = true;
      }
      if (config.Watchdog) {
        document.getElementById('Watchdog').checked = true;
      } else {
        document.getElementById('WatchdogMinerAlgorithmCount').disabled = true;
        document.getElementById('WatchdogMinerCount').disabled = true;
        document.getElementById('WatchdogPoolAlgorithmCount').disabled = true;
        document.getElementById('WatchdogPoolCount').disabled = true;
      }
      if (config.WatchdogMinerAlgorithmCount == null) { 
        document.getElementById('WatchdogMinerAlgorithmCount').value = 3;
      } else {
        document.getElementById('WatchdogMinerAlgorithmCount').value = parseInt(config.WatchdogMinerAlgorithmCount);
      }
      if (config.WatchdogMinerCount == null) { 
        document.getElementById('WatchdogMinerCount').value = 6;
      } else {
        document.getElementById('WatchdogMinerCount').value = parseInt(config.WatchdogMinerCount);
      }
      if (config.WatchdogPoolAlgorithmCount == null) { 
        document.getElementById('WatchdogPoolAlgorithmCount').value = 3;
      } else {
        document.getElementById('WatchdogPoolAlgorithmCount').value = parseInt(config.WatchdogPoolAlgorithmCount);
      }
      if (config.WatchdogPoolCount == null) { 
        document.getElementById('WatchdogPoolCount').value = 7;
      } else {
        document.getElementById('WatchdogPoolCount').value = parseInt(config.WatchdogPoolCount);
      }
      if (config.EstimateCorrection) {
        document.getElementById('EstimateCorrection').checked = true;
      }
      if (config.ApplyUnprofitableAlgorithmList) {
        document.getElementById('ApplyUnprofitableAlgorithmList').checked = true;
      }
      //must be placed after pool loading
      document.getElementById('MPHAPIKey').value = config.MPHAPIKey;
      document.getElementById('MPHAPIKey').disabled = !(document.getElementById('mph').checked);
      document.getElementById('MPHUserName').value = config.MPHUserName;
      document.getElementById('MPHUserName').disabled = !(document.getElementById('mph').checked);
      document.getElementById('NiceHashAPIKey').value = config.NiceHashAPIKey;
      document.getElementById('NiceHashAPIKey').disabled = !(document.getElementById('nicehash').checked);
      document.getElementById('NiceHashAPISecret').value = config.NiceHashAPISecret;
      document.getElementById('NiceHashAPISecret').disabled = !(document.getElementById('nicehash').checked);
      document.getElementById('NiceHashWalletIsInternal').checked = config.NiceHashWalletIsInternal;
      document.getElementById('NiceHashWalletIsInternal').disabled = !(document.getElementById('nicehash').checked);
      document.getElementById('NiceHashWallet').value = config.NiceHashWallet;
      document.getElementById('NiceHashWallet').disabled = !(document.getElementById('nicehash').checked);
      document.getElementById('NiceHashOrganizationId').value = config.NiceHashOrganizationId;
      document.getElementById('NiceHashOrganizationId').disabled = !(document.getElementById('nicehash').checked);
      document.getElementById('ProHashingAPIKey').value = config.ProHashingAPIKey;
      document.getElementById('ProHashingAPIKey').disabled = !(document.getElementById('prohashing24hr').checked);
      document.getElementById('ProHashingUserName').value = config.ProHashingUserName;
      document.getElementById('ProHashingUserName').disabled = !(document.getElementById('prohashing24hr').checked);
    }
  });

  $('#save-button').click(function () {
    config.PoolName = []
    if ((document.getElementById('Wallet').value).toString().trim() == "") {
      document.getElementById('Wallet').value = '1QGADhdMRpp9Pk5u5zG1TrHKRrdK5R81TE';
    };
    config.Wallet = document.getElementById('Wallet').value;
    config.WorkerName = document.getElementById('WorkerName').value;
    if ((document.getElementById('MPHUserName').value).toString().trim() == "") {
      document.getElementById('MPHUserName').value = 'Nemo';
    };
    config.MPHAPIKey = document.getElementById('MPHAPIKey').value;
    config.MPHUserName = document.getElementById('MPHUserName').value;
    config.NiceHashAPIKey = document.getElementById('NiceHashAPIKey').value;
    config.NiceHashAPISecret = document.getElementById('NiceHashAPISecret').value;
    config.NiceHashWallet = document.getElementById('NiceHashWallet').value;
    config.NiceHashWalletIsInternal = document.getElementById('NiceHashWalletIsInternal').checked;
    config.NiceHashOrganizationId = document.getElementById('NiceHashOrganizationId').value;
    config.ProHashingAPIKey = document.getElementById('ProHashingAPIKey').value;
    config.ProHashingUserName = document.getElementById('ProHashingUserName').value;
    if (document.getElementById('Interval').value == null) { 
      document.getElementById('Interval').value = 90;
    };
    config.Interval = parseInt(document.getElementById('Interval').value);
    if (document.getElementById('Donate').value == null) { 
      document.getElementById('Donate').value = 13;
    };
    config.Donate = parseInt(document.getElementById('Donate').value);
    if (document.getElementById('Algorithm').value == null) {
      document.getElementById('Algorithm').value = 'mBTC';
    };
    config.Algorithm = document.getElementById('Algorithm').value.split(',');
    if ((document.getElementById('Currency').value).toString().trim() == null) {
      config.Currency = 'mBTC';
    };
    config.Currency = (document.getElementById('Currency').value).toString().split(',');
    config.PayoutCurrency = document.getElementById('PayoutCurrency').value;
    config.Proxy = document.getElementById('Proxy').value;
    if (document.getElementById('RunningMinerGainPct').value == null) {
      document.getElementById('RunningMinerGainPct').value = 5;
    };
    config.RunningMinerGainPct = parseInt(document.getElementById('RunningMinerGainPct').value);
    config.UnrealPoolPriceFactor = parseFloat(document.getElementById('UnrealPoolPriceFactor').value);
    if (config.UnrealPoolPriceFactor <= 1 || config.UnrealPoolPriceFactor >= 10) { 
      config.UnrealPoolPriceFactor = 3;
      document.getElementById('UnrealPoolPriceFactor').value = config.UnrealPoolPriceFactor;
    }

    $.each(poolnames, function (key, value) {
      if (document.getElementById(value.toLowerCase()).checked == true) {
        (config.PoolName).push(value);
      };
    });
    $.each(regions, function (key, value) {
      if (document.getElementById(value.toLowerCase()).checked == true) {
        config.Region = value;
      };
    });
    config.CalculatePowerCost = document.getElementById('CalculatePowerCost').checked;
    config.PowerPricekWh = JSON.parse(document.getElementById('PowerPricekWh').value);
    config.IgnorePowerCost = document.getElementById('IgnorePowerCost').checked;
    config.ProfitabilityThreshold = parseFloat(document.getElementById('ProfitabilityThreshold').value);
    if (document.getElementById('ProfitabilityThreshold').value == null) { 
      document.getElementById('ProfitabilityThreshold').value = 0;
    };
    config.IncludeRegularMiners = document.getElementById('RegularMiners').checked;
    config.IncludeOptionalMiners = document.getElementById('OptionalMiners').checked;
    config.MinerInstancePerDeviceModel = document.getElementById('MinerInstancePerDeviceModel').checked;
    config.DisableMinerFees = document.getElementById('DisableMinerFees').checked;
    config.DisableMinersWithFees = document.getElementById('DisableMinersWithFees').checked;
    config.DisableDualAlgoMining = document.getElementById('DisableDualAlgoMining').checked;
    config.DisableSingleAlgoMining = document.getElementById('DisableSingleAlgoMining').checked;

    config.AutoStart = document.getElementById('AutoStart').checked;
    config.StartPaused = document.getElementById('StartPaused').checked;
    config.MineWhenIdle = document.getElementById('MineWhenIdle').checked;
    if (document.getElementById('IdleSec').value == null) { 
      document.getElementById('IdleSec').value = 120;
    };
    config.IdleSec = parseInt(document.getElementById('IdleSec').value);
    config.BalancesTrackerPollInterval = document.getElementById('BalancesTrackerPollInterval').value;
    config.EnableBalancesTrackerLog = document.getElementById('EnableBalancesTrackerLog').checked;
    config.StartGUIMinimized = document.getElementById('StartGUIMinimized').checked;
    if (document.getElementById('ShowMinerWindowsHidden').checked) {
      config.ShowMinerWindows = "hidden" 
    }
    if (document.getElementById('ShowMinerWindowsMinimized').checked) {
      config.ShowMinerWindows = "minimized" 
    }
    if (document.getElementById('ShowMinerWindowsNormal').checked) {
      config.ShowMinerWindows = "normal" 
    }
    if (document.getElementById('WatchdogMinerAlgorithmCount').value == null) { 
      document.getElementById('WatchdogMinerAlgorithmCount').value = 120;
    };
    config.WatchdogMinerAlgorithmCount = parseInt(document.getElementById('WatchdogMinerAlgorithmCount').value);
    if (document.getElementById('WatchdogMinerCount').value == null) { 
      document.getElementById('WatchdogMinerCount').value = 120;
    };
    config.WatchdogMinerCount = parseInt(document.getElementById('WatchdogMinerCount').value);
    if (document.getElementById('WatchdogPoolAlgorithmCount').value == null) { 
      document.getElementById('WatchdogPoolAlgorithmCount').value = 120;
    };
    config.WatchdogPoolAlgorithmCount = parseInt(document.getElementById('WatchdogPoolAlgorithmCount').value);
    if (document.getElementById('WatchdogPoolCount').value == null) { 
      document.getElementById('WatchdogPoolCount').value = 120;
    };
    config.WatchdogPoolCount = parseInt(document.getElementById('WatchdogPoolCount').value);
    config.EstimateCorrection = document.getElementById('EstimateCorrection').checked;
    config.ApplyUnprofitableAlgorithmList = document.getElementById('ApplyUnprofitableAlgorithmList').checked;
    config.AutoUpdate = document.getElementById('AutoUpdate').checked;

    //Write current config
    var $command = '/functions/config/set?' + encodeURIComponent(JSON.stringify(config));
    $('.modal-body').load($command, function() {
      $('.modal-title').text($('#save-button').text());
      $('#myModal').modal({show:true});
    });
  });

  // Only one pool variant can be checked
  const Pools = document.getElementById('Pools');
  $(Pools).click(function(event) {
    if ((event.target).value) {
      var PoolName = (event.target).id.toLowerCase();
    }
    var basePoolName = (PoolName.replace('24hr', '')).replace('coins', '');

    var pool = document.getElementById(basePoolName);
    if (pool && PoolName != pool.id) {
      pool.checked = false;
    }

    var pool = document.getElementById(basePoolName + '24hr');
    if (pool && PoolName != pool.id) {
      pool.checked = false;
    }

    var pool = document.getElementById(basePoolName + 'coins');
    if (pool && PoolName != pool.id) {
      pool.checked = false;
    }

    if (PoolName == 'mph') {
      document.getElementById('MPHUserName').disabled = !(document.getElementById(PoolName).checked);
      document.getElementById('MPHAPIKey').disabled = !(document.getElementById(PoolName).checked);
    }
    if (PoolName == 'nicehash') {
      document.getElementById('NiceHashAPIKey').disabled = !(document.getElementById(PoolName).checked);
      document.getElementById('NiceHashAPISecret').disabled = !(document.getElementById(PoolName).checked);
      document.getElementById('NiceHashWallet').disabled = !(document.getElementById(PoolName).checked);
      document.getElementById('NiceHashWalletIsInternal').disabled = !(document.getElementById(PoolName).checked);
      document.getElementById('NiceHashOrganizationId').disabled = !(document.getElementById(PoolName).checked);
    }
    if (PoolName == 'prohashing24hr') {
      document.getElementById('ProHashingUserName').disabled = !(document.getElementById(PoolName).checked);
      document.getElementById('ProHashingAPIKey').disabled = !(document.getElementById(PoolName).checked);
    }
  });

  //dual AND single algo mining cannot be disabled at the same time
  $(document.getElementById('DisableDualAlgoMining')).click(function(event) {
    if (document.getElementById('DisableDualAlgoMining').checked) { document.getElementById('DisableSingleAlgoMining').checked = false }
  });
  $(document.getElementById('DisableSingleAlgoMining')).click(function(event) {
    if (document.getElementById('DisableSingleAlgoMining').checked) { document.getElementById('DisableDualAlgoMining').checked = false }
  });

  //StartPaused
  $(document.getElementById('AutoStart')).click(function(event) {
    document.getElementById('StartPaused').disabled = !(document.getElementById('AutoStart').checked);
  });

  //IdleSec
  $(document.getElementById('MineWhenIdle')).click(function(event) {
    document.getElementById('IdleSec').disabled = !(document.getElementById('MineWhenIdle').checked);
  });

  //Power Cost Settings
  $(document.getElementById('CalculatePowerCost')).click(function(event) {
    document.getElementById('PowerPricekWh').disabled = !(document.getElementById('CalculatePowerCost').checked);
    document.getElementById('IgnorePowerCost').disabled = !(document.getElementById('CalculatePowerCost').checked);
    document.getElementById('ProfitabilityThreshold').disabled = !(document.getElementById('CalculatePowerCost').checked);
    ProfitabilityThreshold
  });

  //EnableBalancesTrackerLog
  $(document.getElementById('BalancesTrackerPollInterval')).click(function(event) {
    document.getElementById('EnableBalancesTrackerLog').disabled = !(document.getElementById('BalancesTrackerPollInterval').value != 0);
  });

  //Watchdog sub item
  $(document.getElementById('Watchdog')).click(function(event) {
    document.getElementById('WatchdogMinerAlgorithmCount').disabled = !(document.getElementById('Watchdog').checked);
    document.getElementById('WatchdogMinerCount').disabled = !(document.getElementById('Watchdog').checked);
    document.getElementById('WatchdogPoolAlgorithmCount').disabled = !(document.getElementById('Watchdog').checked);
    document.getElementById('WatchdogPoolCount').disabled = !(document.getElementById('Watchdog').checked);
  });

  //Load default Algorithm list
  $('#defaultAlgorithm').click(function () {
    $.ajax({url: '/defaultAlgorithm',
      success: function(result) {
        Algorithm.value = "+" + result.join(",+");
      }
    });
  });

</script>

<!-- End of page scripts -->
<!--#include file="/parts/foot.html" -->